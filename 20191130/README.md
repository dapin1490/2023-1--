# 20191130 GA 설계

## ToC
- [20191130 GA 설계](#20191130-ga-설계)
  - [ToC](#toc)
- [문제](#문제)
- [설계](#설계)
  - [UML](#uml)
  - [전체 GA 구조](#전체-ga-구조)
  - [GA 구조 요약](#ga-구조-요약)
  - [해의 표현](#해의-표현)
  - [연산자](#연산자)

# 문제
주어진 그래프를 두 부류로 나누고, 각 부류를 연결하는 간선의 합이 최대가 되게 하라.

# 설계
1. 사용한 GA 구조(팀원 별 의견 표를 포함할 것)
2. 해의 표현(chromosome design, 팀원 별 의견 표를 포함할 것)
3. 사용한 연산자에 대한 설명(selection, crossover, mutation, replacement 등, 팀원 별 의견 표를 포함할 것)

GA의 과정

```md
1. 랜덤한 해를 생성하고(`P_0`) 각 해의 cost 계산
2. 랜덤한 두 부모를 선택 후 교배(원하는 방식대로 섞기)
    * 낮은 확률로 돌연변이 발생(랜덤하게 뭔가 바뀜)
3. 생성된 자식은 전체 유전자 풀에서 안 좋은 해를 대체함
4. 위의 과정을 반복
5. 특정한 조건 하에 반복을 중단하고 가장 좋은 해를 반환함
```

## UML

![basic GA UML.jpg](basic%20GA%20UML.jpg)

## 전체 GA 구조
1. 랜덤 해 생성 및 cost 계산
    1. 노드의 수만큼 A와 B를 각각 50% 확률로 뽑음. A가 뽑힐 확률과 B가 뽑힐 확률이 동일하며, 각 노드마다 뽑히는 사건은 독립적이고, 순서가 유의미하여 모든 해가 서로 다른 해로 간주되기 때문에 모든 해가 균등하게 생성될 확률을 갖는다.
    2. 해가 유효한지 확인  
        * 두 부류는 모두 최소 1개 이상의 노드를 가져야 한다.
        * 두 부류는 최소 1개 이상의 간선으로 서로 연결되어야 한다: 한쪽 부류에 있는 노드가 갖는 모든 간선 중 반대쪽 부류로 이어지는 게 하나라도 있으면 통과
    3. 한 쪽 부류의 모든 노드가 갖는 모든 간선을 검사해 cost 계산: 예를 들어 A 부류에 속한 노드가 갖는 모든 간선 중 B 부류에 속한 노드로 연결되는 간선의 가중치의 합을 계산. 반대로 계산해도 답은 같다(그렇지 않다면 해가 잘못 생성된 것임).
    4. 생성된 해는 랜덤하게 성별을 부여받고 두 대륙으로 나뉜다.
2. 랜덤 부모 선택 후 교배
    1. 부모 선택: 같은 대륙 내에서, 성별이 서로 다른 부모를 뽑는다. thresh를 설정해 서로 cost가 일정량 이하로 차이나는 부모하고만 교배할 수 있게 한다. 또한 낮은 확률로 세기의 사랑 발생, cost 차이가 thresh 값을 넘어서는 부모 쌍이 드물게 생성된다. 기본적으로 부모 한 쌍은 하나의 자식을 생성하지만 이 경우 자식을 둘 생성한다.
    2. 교배: 유전자의 각 자리마다 50% 확률로 부모 둘 중 한 쪽의 것을 선택함.
    3. 돌연변이: 자식 유전자의 각 자리마다 0.8% 확률로 다시 선택함. 바꾸는 것이 아니라 다시 선택하는 것이므로 바뀌기 전과 똑같을 수 있다.
    4. 자식 유효성 검사: 유효하지 않은 해가 생성되었다면 즉시 제거하며 다시 생성하지 않는다.
3. 세대별 대체
    1. 한 세대에서 부모로 선택되는 유전자는 전체 풀의 20%가 되도록 한다(=부모 쌍이 전체 풀의 10% 수만큼 뽑힌다).
    2. 생성된 자식들은 자신과 cost가 비슷하지만 조금 더 큰 유전자를 대체한다. 만약 대체할 유전자가 없을 정도로 cost가 큰 자식이 생성되었다면 98% 확률로 제거되거나 2% 확률로 아무도 대체하지 않고 풀에 추가된다.
        * 만약 한 세대에서 생성된 자식 중 30% 이상이 대체할 수 있는 유전자가 없었다면 진화가 거의 수렴한 것으로 판단하고 대륙 내 교배를 종료한다.
4. 대륙 외 교배: 각 대륙의 내부 진화가 수렴해간다면 대륙 간 교배를 시작한다. 과정은 위와 같으며 초기에는 대량으로 교배하여 대륙 간 혼혈만의 대륙을 새로 만들고, 이후 모두 합쳐 다시 진화를 시작한다. 이때는 대륙을 구분하지 않고 모두 하나의 풀로 취급한다.
5. 다시 진화가 수렴하거나, 제한시간이 다 되면 cost가 제일 적은 해를 반환한다.

## GA 구조 요약
1. 노드의 수만큼 A와 B를 50% 확률로 뽑아 해를 생성하고, 유효한 해인지 검사한 후 cost를 계산하고 성별과 소속 대륙을 부여해 부모 집합을 만든다.
2. 같은 대륙 내에서 서로 다른 성별끼리 교배한다. 부모의 cost 차이가 서로 일정량 이하인 경우만 교배하도록 하며, 낮은 확률로 cost 차이가 큰 부모 쌍이 생성될 수 있고, 자식도 더 많이 생성한다. 생성된 자식을 검사해 유효하지 않은 것은 바로 제거하며 다시 생성하지 않는다.
3. 초기 풀의 유전자 수의 10%만큼 교배를 반복하여 생성된 자식들은 자신과 cost가 비슷하지만 더 큰 유전자를 대체한다. 대체할 유전자가 없는 경우 높은 확률로 제거된다.
4. 각 대륙의 진화가 수렴해간다면 대륙 외 교배를 시작한다.
5. 다시 진화가 수렴하거나 제한 시간이 다 되었을 때 최선의 해를 반환한다.

## 해의 표현
주어진 문제는 그래프에 존재하는 노드를 두 부류로 나누는 것이므로 A와 B 혹은 0과 1 두 가지 기호를 그래프에 존재하는 노드 수만큼 나열하여 문자열 형태로 해를 표현한다.

## 연산자
* selection: 전체 유전자 풀을 두 대륙으로 나누어, 처음에는 같은 대륙끼리만 선택하고 이후 서로 다른 대륙끼리 또는 대륙을 구분하지 않고 선택한다.
* crossover: 해의 각 자리를 50% 확률로 부모 둘 중 한 쪽의 것으로 그대로 이어받는다.
* mutation: 각 자리마다 0.8% 확률로 다시 선택하며, 이전의 값과 똑같을 수 있다.
* replacement: generational GA 방식 이용, cost가 비슷한 것끼리 대체한다.